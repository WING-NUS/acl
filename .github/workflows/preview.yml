# Runs after check-build completes, and pushes out a preview to the mirror server

name: preview

on:
  workflow_run:
    workflows: ['check-build']
    # Should be unnecessary, but here for explicitness
    branches-ignore: ['master']
    types:
    - completed

jobs:
  on-success:
    runs-on: ubuntu-20.04
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
    - name: preview
      env:
        ANTHOLOGY_PREFIX: https://aclanthology.org/previews/${{ steps.extract_branch.outputs.branch }}
      run: |
        make ANTHOLOGY_PREFIX=${ANTHOLOGY_PREFIX} NOBIB=true preview
